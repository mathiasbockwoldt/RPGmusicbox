#!/usr/bin/env python3

import os
import sys
import argparse

from player import Player

os.environ['PYGAME_HIDE_SUPPORT_PROMPT'] = '1'

parser = argparse.ArgumentParser(description='Tool to bring music and sound effects to the game table.')

parser.add_argument('-x', '--xml', help='Path to the XML file with the information')
parser.add_argument('-j', '--json', help='Path to the JSON file with the information (Currently not supported!)')
parser.add_argument('-p', '--path', help='Path to the root of the sound files (Currently not supported!)')

args = parser.parse_args()

if args.xml is None and args.json is None and args.path is None:
	parser.print_help()
	sys.exit()

if args.xml is None:
	print('Currently, only XML files are supported.', file=sys.stderr)
	parser.print_help()
	sys.exit()

if bool(args.xml) + bool(args.json) + bool(args.path):
	print('Please provide only one file.', file=sys.stderr)
	parser.print_help()
	sys.exit()

if args.xml:
	filename = args.xml
elif args.json:
	filename = args.json
elif args.path:
	filename = args.path


# change working directory to the xml file's working directory, so that the paths to media are correct
os.chdir(os.path.dirname(os.path.realpath(filename)))

# The config file is now at the root of the working directory, so no path is needed anymore
filename = os.path.basename(filename)

box = None
if args.xml:
	from xml_reader import read_xml
	box = read_xml(filename)
elif args.json:
	pass
elif args.path:
	pass

player = Player(box)
player.start()
